<!DOCTYPE html>
<html manifest="cache.manifest">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" />
    <title>Mapping Wikileaks' Cablegate</title>
    <link href="http://fonts.googleapis.com/css?family=Droid+Sans|Droid+Sans+Mono" rel="stylesheet" type="text/css" />
    <link id="prettify-link" href="prettify.css" rel="stylesheet" disabled />
    <link href="html5rocks.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery-1.4.4.min.js" language="javascript"></script>
    <script type="text/javascript" src="html5rocks.js" language="javascript+protovis"></script>
  </head>
  <body>
    <div class="presentation">
      <div id="presentation-counter"></div>
      <div class="slides">
        <div class="slide">
          <section class="middle">
            <header><h2>Mapping Wikileaks' Cablegate topics using Python, MongoDB, Neo4j and Gephi</h2></header>
            <p>FOSDEM's data devroom, Brussels, Feb 5 2011</p>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Goals</h2>
            </header>
            <ul class="bulleted">
                <li><p>by analysing cables' full-text and not using meta-data as a structure</p></li>
                <cite><h2>We want to produce a mixed occurrence and co-occurrence network of topics and cables</h2></cite>
                <li><p>in order to visualize how the discussions within the cables are composed and relate to each other</p></li>

            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>How ?</h2>
            </header>
            <ul class="bulleted">
                <li><p>analyse the ~3300 cables with Python, and a set of productive libraries</p></li>
                <li><p>use MongoDB for document storage and Neo4j for network storage</p></li>
                <li><p>explore the network with Gephi</p></li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Import cables to MongoDB</h2>
            </header>
            <ul class="bulleted">
                <li>Hopefully, Wikileak's archive follows a simple structure, making data hackers' job easy !</p></li>
                <li><p>BeautifulSoup : html made easy</p>
                    <ul class="bulleted">
                        <li>automatically decodes to unicode</li>
                        <li>quietly handles html's tree errors</li>
                        <li>traversing methods as Python methods and lists</li>
                        <li>SoupStrainer : tells the parser to target a specific part of the document</li>
                    </ul>
                </p></li>
                <li><p>NLTK : clean_html() and you're done</p>
                    <ul class="bulleted">
                        <li>but still an effort: to handle decoding manually</li>
                        <li>Python provides safe and built-in functions to manage that</li>
                    </ul>
                </p></li>
                <li><p>MongoDB : document storage</p>
                    <ul class="bulleted">
                        <li>transparently inserting and reading records as Python dictionaries</li>
                        <li>automatic types serializing/deserializing : unicode, nested lists and dict, datetime...</li>
                    </ul>
                </p></li>
            </ul>
            <footer>
              <p>
              <a href="https://github.com/anarchivist/cablegate">original project on github</a><br/>
              </p>
            </footer>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Extract topics (1) : tokenize and tag</h2>
            </header>
            <ul class="bulleted">
                <li><p>decompose text into tokens : nltk.sent_tokenize and nltk.TreebankWordTokenizer
                <pre>
>>> sentences = nltk.sent_tokenize("WikiLeaks is a non-profit media organization dedicated to bringing important news and information to the public. We provide an innovative, secure and anonymous way for independent sources around the world to leak information to our journalists.")
['WikiLeaks is a [...] to the public.', 'We provide [...] journalists.']
>>> nltk.TreebankWordTokenizer().tokenize(sentences[0])
['WikiLeaks', 'is', 'a', 'non-profit', 'media', 'organization', 'dedicated', 'to', 'bringing', 'important', 'news', 'and', 'information', 'to', 'the', 'public', '.']
                </pre>
                </p></li>
                <li><p>Part of speech tagging with nltk.tag
                    <pre>
>>> nltk.tag.pos_tag(['Help','Wikileaks','keep','governments','open'])
[('Help', 'NNP'), ('Wikileaks', 'NNP'), ('keep', 'VB'),
('governments', 'NNS'), ('open', 'JJ')]
                    </pre>
              </p></li>
            </ul>
          </section>
        </div>

        <div class="slide">
          <section>
            <header>
              <h2>Extract topics (2) : custom POS tags</h2>
            </header>
            <ul class="bulleted">
              <li>Compose and save a quality tagger with <a href="https://github.com/japerk/nltk-trainer"><i>nltk-trainer</i></a>
                <ul class="bulleted">
                  <li><pre>$ python train_tagger.py --sequential aubt  --default "?" conll2000</pre></p></li>
                  <li><p>The <a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.SequentialBackoffTagger-class.html">nltk.tag.SequentialBackoffTagger</a> chains many taggers together
                    <ul>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.AffixTagger-class.html">nltk.tag.AffixTagger</a> learns from prefix and suffix patterns</li>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.UnigramTagger-class.html">nltk.tag.UnigramTagger</a> learns from each letter composing the word</li>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.BigramTagger-class.html">nltk.tag.BigramTagger</a> also learns from the preceeding word's tag</li>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.TrigramTagger-class.html">nltk.tag.TrigramTagger</a> also learns from the preceeding two words' tag</li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
            <footer>
              <p>
              source code : <a href="https://github.com/japerk/nltk-trainer">https://github.com/japerk/nltk-trainer</a><br/>
              about performances : <a href="http://streamhacker.com/2010/04/12/pos-tag-nltk-brill-classifier/">http://streamhacker.com/2010/04/12/pos-tag-nltk-brill-classifier/</a>
              </p>
            </footer>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Extract topics (3) : stemming</h2>
            </header>
            <ul class="bulleted">
                <li><p>an easy way to de-duplicate topics</p></li>
                <li><p>Group topics by their radicals</p></li>
                <li><p>stemming: nltk.PorterStemmer</p></li>
                <pre>
>>> print PorterStemmer().stem("language")
'languag'
                </pre>
                <li><p>compute sha256 to use it as a database index</p></li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Choose relevant topics</h2>
            </header>
            <ul class="bulleted">
                <li>a DYI POS tag regular expression filtering "useless" words
                  <pre>
^(
    (VB,|VBD,|VBG,|VBN,|CD.?,|JJ.?,|\?,){0,2}?
    (N.?,|\?,)+?
    (CD.,)?
)+?
(
    (PREP.?|DET.?,|IN.?,|CC.?,|\?,)
    (
        (VB,|VBD,|VBG,|VBN,|CD.?,|JJ.?,|\?,){0,2}?
        (N.?,|\?,)+?
    )+?
)*?$
                  </pre>
                </li>
                <!--<li><p>a tf-idf score of topics within a generic nltk corpora</p></li>-->
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Create the network : from MongoDB to Neo4j (2)</h2>
            </header>
            <ul class="bulleted">
                <li><p>Writing to MongoDB, a delicate science
                  <ul class="bulleted">
                    <li>limit the size of your record : <= 4MB</li>
                    <li>use update and modifiers as much as possible
                    <pre>
mongodb.cooc.update({'_id': some_id}, {"$inc":{"value":1}})
                    </pre>
                    </li>
                  </ul>
                </p></li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Create the network : from MongoDB to Neo4j (2)</h2>
            </header>
            <ul class="bulleted">
                <li><p>Reading from MongoDB, querying features integrated with Python
                  <ul>
                    <li>extract all cables between to dates
                <pre>
cable_iterator = mongodb.cables.find(
  {"datetime":{
      "$gte":datetime(year,1,1,0,0,0), "$lt":datetime(year+1,1,5,0,0,0)
    }
  }, timeout=False)
                </pre>
                    </li>
                    <li>extract the heaviest co-occurrences edges from a node
                <pre>
mystartswith_regexp = re.compile("^"+mysha256+"_[a-z0-9]+$")
cooc_curs = mongodb.cooc.find(
  {"_id":{
      "$regex": mystartswith_regexp
  }},
  timeout=False,
  sort=[("value",pymongo.DESCENDING)],
  limit=MAXEDGES)
                </pre>
                    </li>
                  </ul>
                </p></li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Creating the network : from MongoDB to Neo4j (3)</h2>
            </header>
            <ul class="bulleted">
                <li><p>millions of inserts into neo4j db done in a few minutes (with the officially supported neo4j.py component)</p></li>
                <li><p></p></li>
            </ul>
          </section>
        </div>


        <div class="slide">
          <section>
            <header>
              <h2>Introduction to Gephi (http://gephi.org)</h2>
            </header>
            <ul class="bulleted">
                <li>An AGPL3 desktop app for <b>visualization of complex networks</b></li>
                <li>Dedicated toolset for <b>social network analysis</b> and <b>network map</b> creation</li>
                <li>Based on <b>Java</b>, <b>NetBeans Platform</b> and <b>OpenGL</b> (JOGL)</li>
                <li>Also available as headless library: <b>Gephi Toolkit</b></li>
                <li>Connect nicely with <b>Jython</b>, <b>JPype</b>..</li>
                <li>Plugin center, with connectors for <b>Neo4J</b>, <b>SQL</b>, some social networks API..</li>
                <li>To learn more about: http://gephi.org/users/</li>
            </ul>

          </section>
        </div>

        <div class="slide">
          <section>
            <header>
              <h2>Gephi Demo (screencast)</h2>
            </header>


          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Summary of our Gephi workflow</h2>
            </header>
            <ol class="ordered">
                <li>Import data from database</li>
                <li>Filter on data (coocs) but also graph topology (degree)</li>
                <li>..</li>
                <li>..</li>
                <li>Preview the final map, to tweak sizes and fonts</li>
                <li>Finally, we can export to PDF, SVG and SeaDragon (web-zoom map)</li>
            </ol>
          </section>
        </div>

        <div class="slide">
          <section>
            <header>
                <h2>To sum up, cablegate_semnet is:</h2>
            </header>
              <ul class="bulleted">
                  <li><p>~600 lines of GNU/GPL code, depending on 4 external libraries</p></li>
                  <li><p>1 full week coding</p></li>
                  <li><p>1 network of 3,371 + 24,081 nodes and 16,144,100 co-occurrences edges</p></li>
                  <li><p>1 process, some RAM, billions of reads/inserts/updates to Neo4j and MongoDB</p></li>
                  <li><p>1 talk, 1 FOSDEM, 1 big leak</p></li>
              </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Thanks</h2>
            </header>
            <p>A special thank to <a href="http://wikileaks.ch/">Wikileaks</a>
            <ul class="bulleted">
                <li>any questions ?</li>
                <li>fork our project on Github <a href="https://github.com/elishowk/cablegate_semnet">http://github.com/elishowk/cablegate_semnet</a></li>
                <li>follow us : <a href="http://github.com/elishowk">@elishowk</a> and <a href="http://github.com/jbilcke">@jbilcke</a> (we're on Twitter too)</li>
                <li>Visit the <a href="http://gephi.org">Gephi.org community</a></li>
            <p>Learn more at:</p>
            </ul>
              <ul class="bulleted">
                  <li><a href="http://www.crummy.com/software/BeautifulSoup/">BeautifulSoup</a></li>
                  <li><a href="http://www.nltk.org">NTLK</a></li>
                  <li><a href="http://www.mongodb.org">MongoDB</a></li>
                  <li><a href="http://neo4j.org/">Neo4J</a></li>
                  <li><a href="http://components.neo4j.org/neo4j.py/t">Neo4J for Python</a></li>
                  <li><a href="http://gephi.org/2010/gsoc-2010-mid-term-adding-support-for-neo4j-in-gephi/">Martin Škurl (Neo4j Gephi Plugin)</a></li>
                  <li><a href="http://slides.html5rocks.com">html5rocks!</a></li>
              </ul>
          </section>
        </div>
      </div> <!-- slides -->
    </div> <!-- presentation -->
    <!--[if lt IE 9]>
    <script
      src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js">
    </script>
        <script>CFInstall.check({ mode: "overlay" });</script>
    <![endif]-->

  </body>
</html>
