<!DOCTYPE html>
<html manifest="cache.manifest">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1" />
    <title>Mapping Wikileaks' Cablegate</title>
    <link href="droid.css" rel="stylesheet" type="text/css" />
    <link href="prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="prettify.js"></script>
    <link href="html5rocks.css" rel="stylesheet" type="text/css" />
    <!--<script src="seadragon-min.js" type="text/javascript"></script>-->
    <script src="jquery-1.4.4.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="html5rocks.js" language="javascript+protovis"></script>
  </head>
  <body onload="prettyPrint()">
    <div class="presentation">
      <div id="presentation-counter"></div>
      <div class="slides">
        <div class="slide">
          <section class="middle">
            <header><h2>Mapping Wikileaks' Cablegate topics using Python, MongoDB, Neo4j and Gephi</h2></header>
            <p><img src="images/200px-Wikileaks_logo.png" width="160" height="370" />
              <!--<img src="images/mongo-db.jpg" width="200" height="67" />
              <img src="images/python_logo.png" width="180" height="61" />-->
            </p>
            <!--<p>FOSDEM's data devroom, Brussels, Feb 5 2011</p>-->
            <p>Paris.pm, march 16th 2011</p>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Goals</h2>
            </header>
            <ul class="bulleted">
                <li><p>to analyse cables' full-text, not using meta-data as a structure</p></li>
                <li><p><b><i>to produce occurrence networks of bi-grams and cables</i></b></p></li>
                <li><p>to visualize how the discussions within the cables are composed and relate to each other</p></li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section class="middle">
            <header>
              <h2>A preview of the result</h2>
            </header>
            <img src="images/global.png" width="600px"/>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>How ?</h2>
            </header>
            <ul class="bulleted">
                <li><p>analyse the ~5500 released cables with Python, and a set of productive libraries (NLTK)</p></li>
                <li><p>use MongoDB and Neo4j for document and network storage</p></li>
                <li><p>explore the network with Gephi</p></li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Import cables to MongoDB</h2>
            </header>
            <ul class="bulleted">
                <li>Hopefully, Wikileak's archive follows a simple structure, making data hackers' job easy !</p></li>
                <li><p>first used BeautifulSoup then switched to <a href="https://github.com/heuer/cablemap">Cablemap</a></p>
                    <ul class="bulleted">
                        <li>based on regular expressions and very fast</li>
                        <li>automatically decodes to <b>unicode</b>, a type in Python, same api as <b>string</b></li>
                    </ul>
                </p></li>
                <li><p>NLTK : clean_html() and you're done</p>
                    <ul class="bulleted">
                        <li>but still an effort: to handle re-encoding manually</li>
                        <li>Python provides safe and built-in functions to manage that : <b>unicode()</b>, <b>encode</b></li>
                    </ul>
                </p></li>
                <li><p>MongoDB : document storage</p>
                    <ul class="bulleted">
                        <li>transparently inserting and reading records as Python <b>dict</b>, a hash-map type without type constraint</li>
                        <li>automatic serializing/deserializing built-in types : unicode, nested lists and dict, datetime, reg-exp objects...</li>
                    </ul>
                </p></li>
            </ul>
            <footer>
              <p>
              <a href="https://github.com/anarchivist/cablegate">anarchivist/cablegate, the forked project on github for cable importing</a><br/>
              </p>
            </footer>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Extract topics (1) : tokenize</h2>
            </header>
            <ul class="bulleted">
                <li>
                    <p>decompose text into tokens : nltk.sent_tokenize and nltk.TreebankWordTokenizer
                        <pre class="prettyprint">
>>> sentences = nltk.sent_tokenize("WikiLeaks is a non-profit media organization dedicated to bringing important news and information to the public. We provide an innovative, secure and anonymous way for independent sources around the world to leak information to our journalists.")
['WikiLeaks is a [...] to the public.', 'We provide [...] journalists.']


>>> nltk.TreebankWordTokenizer().tokenize(sentences[0])
['WikiLeaks', 'is', 'a', 'non-profit', 'media', 'organization', 'dedicated', 'to', 'bringing', 'important', 'news', 'and', 'information', 'to', 'the', 'public', '.']
                        </pre>
                    </p>
                </li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Extract topics (2) : stemming</h2>
            </header>
            <ul class="bulleted">
                <li><p>an easy way to de-duplicate words</p></li>
                <li><p>group words by their radical</p></li>
                <li><p>use nltk.PorterStemmer</p></li>
                <pre class="prettyprint" >
>>> print PorterStemmer().stem("language")
'languag'
                </pre>
                <li><p>compute the built-in sha256 hash method to use it as a database index</p></li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Extract topics (3) : part of speech tagging with nltk.tag</h2>
            </header>
            <ul class="bulleted">
              <li><p>
<pre class="prettyprint">
>>> nltk.tag.pos_tag(['Help','Wikileaks','keep','governments','open'])
[('Help', 'NNP'), ('Wikileaks', 'NNP'), ('keep', 'VB'),
('governments', 'NNS'), ('open', 'JJ')]
</pre>
              </p></li>
              <li>Compose and save a quality tagger</a>
                <ul class="bulleted">
                  <li><p>nltk comes with many pre-tagged corpora to learn from. we used 2 corpora = ~68000 sentences</p></li>
                  <li><p>The <a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.SequentialBackoffTagger-class.html">nltk.tag.SequentialBackoffTagger</a> chains many taggers together
                    <ul>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.TrigramTagger-class.html">nltk.tag.TrigramTagger</a> also learns from the preceeding two words' tag</li>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.BigramTagger-class.html">nltk.tag.BigramTagger</a> also learns from the preceeding word's tag</li>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.UnigramTagger-class.html">nltk.tag.UnigramTagger</a> learns from each letter composing the word</li>
                      <li><a href="http://nltk.googlecode.com/svn/trunk/doc/api/nltk.tag.sequential.AffixTagger-class.html">nltk.tag.AffixTagger</a> learns from prefix and suffix patterns</li>
                    </ul>
                  </li>
                  <li>machine learning is long, so saved the serialized object</li>
                </ul>
              </li>
            </ul>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Choose more relevant topics</h2>
            </header>
            <ul class="bulleted">
                <li>a DIY regular expression for filtering tags, or "useless" n-grams
                  <pre class="prettyprint">
^(
    (VB,|VBD,|VBG,|VBN,|CD.?,|JJ.?,|\?,){0,2}?
    (N.?,|\?,)+?
    (CD.,)?
)+?$
                  </pre>
                </li>
            </ul>
            <footer>
              <p>
              ready to use taggers : <a href="https://github.com/japerk/nltk-trainer">github.com/japerk/nltk-trainer</a><br/>
              nice articles about nltk tagging : <a href="http://streamhacker.com/2010/04/12/pos-tag-nltk-brill-classifier/">http://streamhacker.com/2010/04/12/pos-tag-nltk-brill-classifier/</a>
              </p>
            </footer>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Create the network : from MongoDB to Neo4j (1)</h2>
            </header>
            <ul class="bulleted">
                <li><p>Writing to MongoDB :
                  <ul class="bulleted">
                    <li><p>(mis-)used as key/value storage : <i>update</i> and </i>modifiers</i> are the key to success
                    <pre class="prettyprint">
mongodb.cooc.update({'_id': some_id}, {"$inc":{"value":1}})
                    </pre>
                    </p></li>
                    <li><p>compose id patterns to organize records : the edge example
                    <pre class="prettyprint">
mongodb.cooc.save({'_id': node-source_id +"_"+ node_target_id, "value":1})
                    </pre>
                    </p></li>

                  </ul>
                </p></li>
            </ul>
            <footer>
              <p>learn more at : <a href="http://ur1.ca/33p5l">http://ur1.ca/33p5l</a> and <a href="http://ur1.ca/33p59">http://ur1.ca/33p59</a></p>
            </footer>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Create the network : from MongoDB to Neo4j (2)</h2>
            </header>
            <ul class="bulleted">
                <li><p>Querying MongoDB :
                  <ul class="bulleted">
                    </p></li>
                    <li>example : extract the heaviest co-occurrences edges from a node
                      <pre class="prettyprint">
mystartswith_regexp = re.compile("^"+mysha256+"_[a-z0-9]+$")
cooc_curs = mongodb.cooc.find(
    {"_id":{
        "$regex": mystartswith_regexp
    }},
    timeout=False,
    sort=[("value",pymongo.DESCENDING)],
    limit=MAXEDGES)
                      </pre>
                    </li>
                    <!--<li>extract all cables between to dates
                <pre class="prettyprint">
cable_iterator = mongodb.cables.find(
  {"datetime":{
      "$gte":datetime(year,1,1,0,0,0), "$lt":datetime(year+1,1,5,0,0,0)
      }
  }, timeout=False)
                </pre>
                    </li>-->
                  </ul>
                </p></li>
            </ul>
            <footer>
              <p>learn more at : <a href="http://ur1.ca/33p5l">http://ur1.ca/33p5l</a> and <a href="http://ur1.ca/33p59">http://ur1.ca/33p59</a></p>
            </footer>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Creating the network : from MongoDB to Neo4j (3)</h2>
            </header>
            <ul class="bulleted">
              <li><p>About <img src="images/neo4j_logo200.png" /> :
                <ul>
                  <li><p>use the official neo4j.py component (using python-jpype)</p></li>
                  <li><p>use wide transactions to reach the maximum performance
                  <pre class="prettyprint">
with graphdb.transaction as trans:
    node = self.graphdb.node()
    node[key.encode("ascii","ignore")] = value.encode("ascii","ignore")
                  </pre>
                  </p></li>
                  <li><p>control types written to nodes properties : use ascii</p></li>
                  <!--<li><p>insertion time example : </p></li>-->
                  <li><p>Neo4j for Gephi as a plugin : the direct connection</p></li>
                </ul>
            </ul>

          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Introduction to <img src="images/gephi-logo-2010-transparent.png" width="144" height="46" /></h2>
            </header>
            <ul class="bulleted">
                <li>An AGPL3 desktop app for <b>visualization of complex networks</b></li>
                <li>Dedicated toolset for <b>social network analysis</b> and <b>network map</b> creation</li>
                <li>Based on <b>Java</b>, <b>NetBeans Platform</b> and <b>OpenGL</b> (JOGL)</li>
                <li>Also available as headless library: <b>Gephi Toolkit</b></li>
                <li>Connect nicely with <b>Jython</b>, <b>JPype</b>..</li>
                <li>Plugin center, with connectors for <b>Neo4J</b>, <b>SQL</b>, some social networks API..</li>
                <li>To learn more about: <b>http://gephi.org</b></li>
            </ul>
          </section>
        </div>

        <div class="slide">
          <section>
<header>
<video id="player" controls>
  <source src="gephi_wikileaks.webm" />
  To view this video you need the latest version of <a href="http://www.apple.com/safari/">Safari</a>, <a href="http://www.mozilla.com/firefox/">Firefox</a> or <a href="http://www.google.com/chrome">Chrome</a>. Alternatively download the videos and watch them offline.
</video>
</header>
<footer>
<a href="gephi_wikileaks.webm">movie file link</a>
</footer>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Summary of our Gephi workflow</h2>
            </header>
            <ol class="ordered">
                <li><p>Import network from database</p></li>
                <li><p>Basic data laboratory features (sort, delete)</p></li>
                <li><p>Rank category and occurrences to colors</p></li>
                <li><p>Filter data on graph topology (degree and weight)</p></li>
                <li><p>Spatialize the network using an OpenOrd layout</p></li>
                <li><p>Remove artifacts direclty from the visualization</p></li>
                <li><p>Preview the final map, to tweak appearance</p></li>
                <li><p>Finally export the map to PDF and GEXF</p></li>
            </ol>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
                <h2>To sum up:</h2>
            </header>
              <ul class="bulleted">
                  <li><p>~600 lines of GNU/GPL one-shot code, 5 external libraries, 2 databases, and 1 Gephi</p></li>
                  <li><p>~1 full week coding, ~5 hours executing the whole process</p></li>
                  <li><p>2 networks obtained without much science :
                  <ul class="bulleted">
                    <li>bi-grams topics and cables, linked by occurrences : 43 179 nodes, 237 058 edges</li>
                    <li>bi-grams topics only, linked by co-occurrences : 39 808 nodes, 177 023 edges</li>
                  </ul>
                  </p></li>
                  <li><p>2 maps online to be explored by all topic maps lovers
                  <!--  -->
                  </p></li>
                  <li><p>1 talk, 1 FOSDEM, 1 big leak ;-)</p></li>
              </ul>
          </section>
        </div>
        <div class="slide">
          <section  class="middle">
            <header>
              <h2>A zoom on Egypt's cables</h2>
            </header>
            <img src="images/zoom_egypt.png"  width="600px"/>
          </section>
        </div>
        <div class="slide">
          <section  class="middle">
            <header>
              <h2>A zoom on "Central Bank" neighbourhood</h2>
            </header>
            <img src="images/zoom_central_bank.png"  width="600px"/>
          </section>
        </div>
        <div class="slide">
          <section>
            <header>
              <h2>Thanks</h2>
            </header>
            <p>A special thank to <a href="http://wikileaks.ch/">Wikileaks</a>
            <ul class="bulleted">
                <li>any questions ?</li>
                <li>fork our project on Github <a href="https://github.com/elishowk/cablegate_semnet">https://github.com/elishowk/cablegate_semnet</a></li>
                <li><a href="http://tina.iscpif.fr/htdocs/fosdem2011">Data sets</a></li>
                <li>follow us : <a href="http://github.com/elishowk">@elishowk</a> and <a href="http://github.com/jbilcke">@jbilcke</a> (we're on Twitter too)</li>
                <li>Visit the <a href="http://gephi.org">Gephi.org community</a></li>
            <p>Learn more at:</p>
            </ul>
              <ul class="bulleted">
                  <li><a href="https://github.com/heuer/cablemap">Cablemap on github</a></li>
                  <li><a href="http://www.nltk.org">NTLK</a> and <a href="https://github.com/japerk/nltk-trainer">nltk trainer</a><br/></li>
                  <li><a href="http://www.mongodb.org">MongoDB</a></li>
                  <li><a href="http://neo4j.org/">Neo4J</a></li>
                  <li><a href="http://gephi.org/2010/gsoc-2010-mid-term-adding-support-for-neo4j-in-gephi/">Martin Å kurl (Neo4j Gephi Plugin)</a></li>
                  <li><a href="http://slides.html5rocks.com">and html5rocks!</a></li>
              </ul>
          </section>
        </div>
      </div> <!-- slides -->
    </div> <!-- presentation -->
    <!--[if lt IE 9]>
    <script
      src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js">
    </script>
        <script>CFInstall.check({ mode: "overlay" });</script>
    <![endif]-->

  </body>
</html>
